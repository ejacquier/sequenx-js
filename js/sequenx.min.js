/*! sequenx-js-build - v1.0.0 - 2016-06-08 */var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},Sequenx;!function(a){var b=function(){function a(b,c){this._parent=c,this._name=null!=b?b:"",this._id=a.s_nextId++,a.isEnabled&&console.log(this.fullName+a.StartSuffix)}return Object.defineProperty(a.prototype,"name",{get:function(){return this._name},set:function(a){},enumerable:!0,configurable:!0}),a.prototype.toString=function(){return this.fullName},a.prototype.dispose=function(){this._isDisposed||(a.isEnabled&&console.log(this.fullName+a.EndSuffix),this._isDisposed=!0)},a.prototype.getChild=function(b){return new a(b,this)},a.prototype.info=function(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];a.isEnabled&&console.log(this.format(b,c))},a.prototype.warning=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];console.warn(this.format(a,b))},a.prototype.error=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];console.error(this.format(a,b))},Object.defineProperty(a.prototype,"fullName",{get:function(){return null==this._fullName&&(null!=this._parent?this._fullName=this._parent.fullName+a.PathSeparator+this.getNameWithId():this._fullName=this.getNameWithId()),this._fullName},enumerable:!0,configurable:!0}),a.prototype.getNameWithId=function(){return"("+this._id+") "+this._name},a.prototype.format=function(b,c){return b&&null!=c&&c.length>0&&(b=this.strFormat(b,c)),this.fullName+a.MessageSeparator+b},a.prototype.strFormat=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];var d=b;return a.replace(/{(\d+)}/g,function(a,b){return"undefined"!=typeof d[b]?d[b]:a})},a.PathSeparator="     ",a.MessageSeparator="     ",a.StartSuffix=" [START]",a.EndSuffix=" [END]",a.s_nextId=1,a.isEnabled=!0,a}();a.Log=b}(Sequenx||(Sequenx={}));var Sequenx;!function(a){var b=function(){function b(b){var c=this;this._completedSubject=new Rx.Subject,"string"==typeof b?this._log=new a.Log(name):this._log=b,this._refCountDisposable=new Rx.RefCountDisposable(Rx.Disposable.create(function(){return c.lapseCompleted()}))}return Object.defineProperty(b.prototype,"completed",{get:function(){return this._completedSubject},set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"name",{get:function(){return this._log.name},set:function(a){},enumerable:!0,configurable:!0}),b.prototype.getChildLog=function(a){return this._log.getChild(a)},b.prototype.sustain=function(b){return this._isCompleted||this._isDisposed?Rx.Disposable.empty:(b&&a.Log.isEnabled&&this._log.info("Sustain "+b),this._refCountDisposable.getDisposable())},b.prototype.start=function(){this._isStarted||this._isCompleted||this._isDisposed||(this._isStarted=!0,this._refCountDisposable.dispose())},b.prototype.dispose=function(){this._isDisposed||(this._isCompleted||this._log.info("Cancelling"),this.lapseCompleted())},b.prototype.lapseCompleted=function(){this._isCompleted||(this._isCompleted=!0,this._isDisposed=!0,this._log.dispose(),this._completedSubject.onCompleted())},b.prototype.onCompleted=function(a){return this.completed.subscribeOnCompleted(a)},b.prototype.sequence=function(b,c){var d=this.sustain(),e=c?c:"Sequence",f=this.getChildLog(e),g=new a.Sequence(f);return g.onCompleted(function(){return d.dispose()}),b(g),g.start(),g},b.prototype.child=function(a,c){var d=this.sustain(),e=c?c:"Child",f=this.getChildLog(e),g=new b(f);g.onCompleted(function(){return d.dispose()}),a(g),g.start()},b.prototype.disposeOnComplete=function(a){this.onCompleted(function(){return a.dispose()})},b}();a.Lapse=b}(Sequenx||(Sequenx={}));var Sequenx;!function(a){var b=function(){function b(b){this._lapseDisposables=new Rx.CompositeDisposable,this._currentLapseDisposable=Rx.Disposable.empty,this._pendingExecution=Rx.Disposable.empty,this._items=new Array,this._completedSubject=new Rx.Subject,b&&("string"==typeof b?this._log=new a.Log(b):this._log=b)}return Object.defineProperty(b.prototype,"completed",{get:function(){return this._completedSubject},set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"name",{get:function(){return this._log.name},set:function(a){},enumerable:!0,configurable:!0}),b.prototype.getChildLog=function(a){return this._log.getChild(a)},b.prototype.add=function(b){if(!(b instanceof a.Item))return void this._log.error("Trying to add something other than Sequenx.Item, use do if you use a function(lapse)");if(this._isDisposed)throw new Error("Trying to add action to a disposed sequence.");this._items.push(b)},b.prototype.skip=function(a,b){for(;this._items.length>0&&a(this._items[0]);)this._items.splice(0,1);b&&this._currentLapseDisposable.dispose()},b.prototype.skipTo=function(a,b){for(var c=-1,d=0;d<this._items.length;d++)if(a(this._items[d])){c=d;break}-1!=c&&(this._items=this._items.slice(c),b&&this._currentLapseDisposable.dispose())},b.prototype.start=function(){this._isStarted||this._isDisposed||(this._isStarted=!0,this.scheduleNext())},b.prototype.scheduleNext=function(){this._pendingExecution.dispose(),this._pendingExecution=Rx.Scheduler.currentThread.schedule("item",this.executeNext.bind(this))},b.prototype.executeNext=function(b,c){var d=this;if(!(this._isExecuting||this._isCompleted||this._isDisposed)){if(0===this._items.length)return void this.onLastItemCompleted();var e=this._items.shift();if(!e.action)return void(e.message&&this._log.info("Message: "+e.message));var f=new a.Lapse(this._log.getChild(e.message));this._currentLapseDisposable=f,this._lapseDisposables.add(f),f.onCompleted(function(){d._isExecuting=!1,d.scheduleNext()});try{this._isExecuting=!0,e.action(f),f.start()}catch(g){this._isExecuting=!1,this._log.error(g+"\n"+g.stack),this.scheduleNext()}}},b.prototype.onLastItemCompleted=function(){this.onSequenceComplete()},b.prototype.dispose=function(){this._isDisposed||(this._isCompleted||this._log.info("Cancelling"),this.onSequenceComplete())},b.prototype.onSequenceComplete=function(){this._isCompleted||(this._isCompleted=!0,this._isDisposed=!0,this._lapseDisposables.dispose(),this._log.dispose(),this._completedSubject.onCompleted())},b.prototype.onCompleted=function(a){return this.completed.subscribeOnCompleted(a)},b.prototype["do"]=function(a,b){null!=a&&this.add(new c(a,b))},b.prototype.doMark=function(a){var b=a?a:{};return this.add(new c(null,null,b)),b},b.prototype.skipToMarker=function(a,b){b=void 0==b?!1:b,this.skipTo(function(b){return b.data===a},b)},b.prototype.skipToEnd=function(a){a=void 0==a?!1:a,this.skip(function(a){return!0},a)},b.prototype.doWait=function(a,b){this["do"](function(a){var b=a.sustain();setTimeout(function(){b.dispose()})},b?b:"Wait "+a/1e3+"s")},b.prototype.doWaitForDispose=function(a){var b=new Rx.SingleAssignmentDisposable;return this["do"](function(a){return b.setDisposable(a.sustain())},a?a:"WaitForDispose"),b},b.prototype.doWaitForCompleted=function(a,b){var c=new Rx.SingleAssignmentDisposable;a.subscribeOnCompleted(function(){return c.dispose()}),this["do"](function(a){return c.setDisposable(a.sustain())},b?b:"WaitForCompleted")},b.prototype.doWaitForNext=function(a,b){var c=new Rx.SingleAssignmentDisposable;a.subscribeOnNext(function(){return c.dispose()}),this["do"](function(a){return c.setDisposable(a.sustain())},b?b:"WaitForNext")},b.prototype.doWaitFor=function(a,b){this.doWaitForCompleted(a.completed,b)},b.prototype.doParallel=function(b,c){this["do"](function(c){var d=new a.Parallel(c);b(d)},c?c:"Parallel")},b.prototype.doDispose=function(a,b){this["do"](function(b){return a.dispose()},b?b:"Dispose")},b.prototype.doSequence=function(a,c){var d=this;this["do"](function(e){var f=e.sustain(),g=d.getChildLog(c),h=new b(g);h.onCompleted(function(){return f.dispose()}),e.onCompleted(h.dispose),a(h),h.start()},c?c:"Sequence")},b}();a.Sequence=b;var c=function(){function a(a,b,c){this.action=a?a:function(){},this.message=b,this.data=c}return a.prototype.toString=function(){return this.message,null!=this.action,this.data},a}();a.Item=c}(Sequenx||(Sequenx={}));var Sequenx;!function(a){var b=function(b){function c(a){b.call(this),this._lapse=a}return __extends(c,b),Object.defineProperty(c.prototype,"completed",{get:function(){return this._lapse.completed},set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"name",{get:function(){return this._lapse.name},set:function(a){},enumerable:!0,configurable:!0}),c.prototype.getChildLog=function(a){return this._lapse.getChildLog(a)},c.prototype.add=function(b){return b instanceof a.Item?void this._lapse.child(b.action,b.message):void this._log.error("Trying to add() something other than Sequenx.Item, use do if you use a function(lapse)")},c.prototype.skip=function(a,b){throw new Error("skip not implemented for Parallel")},c.prototype.skipTo=function(a,b){throw new Error("skipTo not implemented for Parallel")},c}(a.Sequence);a.Parallel=b}(Sequenx||(Sequenx={}));